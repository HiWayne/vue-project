{"remainingRequest":"D:\\vue-cli-demo\\sell\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue-cli-demo\\sell\\src\\components\\goods\\goods.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue-cli-demo\\sell\\src\\components\\goods\\goods.vue","mtime":1554990639924},{"path":"D:\\vue-cli-demo\\sell\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue-cli-demo\\sell\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\vue-cli-demo\\sell\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue-cli-demo\\sell\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Scroll from 'better-scroll'\r\nimport cartcontrol from '../cartcontrol/cartcontrol.vue'\r\nimport food from '../food/food.vue'\r\n\r\nconst ERROK = 0\r\n\r\nexport default {\r\n  props: {\r\n    seller: {\r\n      type: Object,\r\n      required: true\r\n    },\r\n    //已选择的食品\r\n    selectfoods: {\r\n      type: Array,\r\n      required: true\r\n    },\r\n    //shopcart组件实例\r\n    shopcartComponent: {\r\n      type: Object,\r\n      required: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      //异步从服务器get数据\r\n      goods: [],\r\n      //不同的type映射到不同的class\r\n      classMap: ['decrease', 'discount', 'special', 'invoice', 'guarantee'],\r\n      //存放右侧栏目高度\r\n      heightArray: [],\r\n      //当前滚动高度\r\n      currentHeight: 0,\r\n      //进入食品详情页时该食品的数据\r\n      selectedFood: {},\r\n      //食品详情页是否显示\r\n      show: false\r\n    }\r\n  },\r\n  created: function () {\r\n    this.$http.get('/api/goods')\r\n    .then((res) => {\r\n      if (res.data.errno === ERROK) {\r\n        this.goods = res.data.data\r\n      }\r\n      else new Error()\r\n    })\r\n    .catch((error) => {\r\n      console.log(error)\r\n    })\r\n  },\r\n  mounted: function () {\r\n      this.scrollMenu = new Scroll(this.$refs.menu, {\r\n        click: true\r\n      })\r\n\r\n      this.scrollFood = new Scroll(this.$refs.food, {\r\n        click: true,\r\n        probeType: 3\r\n      })\r\n      this.scrollFood.on('scroll', (pos) => {\r\n        this.currentHeight = Math.abs(pos.y)\r\n      })\r\n  },\r\n  computed: {\r\n    leftIndex: function () {\r\n      for (let i = 0; i < this.heightArray.length; i++) {\r\n        if (this.heightArray[i + 1] && this.currentHeight >= this.heightArray[i] && this.currentHeight < this.heightArray[i + 1]) {\r\n          return i\r\n        }\r\n      }\r\n      return 0\r\n    }\r\n  },\r\n  watch: {\r\n    goods: function() {\r\n      this.$nextTick(() => {\r\n        let foodList = this.$refs.fooditem, addHeight = 0\r\n        this.heightArray.push(0)\r\n        for (let i = 0; i < foodList.length; i++) {\r\n          addHeight += foodList[i].clientHeight\r\n          this.heightArray.push(addHeight)\r\n        }\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    scrollto: function (index, event) {\r\n      if (!event._constructed) {\r\n        return\r\n      }\r\n      else {\r\n        const foods = this.$refs.fooditem\r\n        let target = foods[index]\r\n        this.scrollFood.scrollToElement(target, 400)\r\n      }\r\n    },\r\n    drop: function (el) {\r\n      this.shopcartComponent.dropball(el)\r\n    },\r\n    selectFood: function (food) {\r\n      if (food) {\r\n        this.selectedFood = food\r\n      }\r\n      this.show = !this.show\r\n    }\r\n  },\r\n  components: {\r\n    cartcontrol,\r\n    food\r\n  }\r\n}\r\n",{"version":3,"sources":["goods.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"goods.vue","sourceRoot":"src/components/goods","sourcesContent":["<template>\r\n  <div class=\"goods\">\r\n    <div class=\"menu-wrapper\" ref=\"menu\">\r\n      <ul class=\"menu-list\">\r\n        <li v-for=\"(item, index) of goods\" v-bind:key=\"index\" class=\"menu-item border-1px\" v-bind:class=\"{on:index === leftIndex}\" v-on:click=\"scrollto(index, $event)\">\r\n          <span class=\"menu-name\">\r\n            <span v-if=\"item.type!==-1\" class=\"icon\" v-bind:class=\"classMap[item.type]\"></span>{{item.name}}\r\n          </span>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"foods-wrapper\" ref=\"food\">\r\n      <div class=\"food-scroll-wrapper\">\r\n        <div v-for=\"(item, index) of goods\" v-bind:key=\"index\" ref=\"fooditem\">\r\n          <div class=\"food-menu\">{{item.name}}</div>\r\n          <ul class=\"food-list\">\r\n            <li v-for=\"(food, index) of item.foods\" v-bind:key=\"index\" class=\"food-item border-1px on\">\r\n              <div class=\"food-icon\" v-on:click=\"selectFood(food)\"><img v-bind:src=\"food.icon\"></div>\r\n              <div class=\"food-detail\">\r\n                <div class=\"food-select-wrapper\" v-on:click=\"selectFood(food)\">\r\n                  <h1 class=\"food-name\">{{food.name}}</h1>\r\n                  <div v-if=\"food.description\" class=\"food-description\">{{food.description}}</div>\r\n                  <div class=\"food-data\"><span class=\"food-sell\">月售{{food.sellCount}}份</span><span class=\"food-rating\">好评率{{food.rating}}%</span></div>\r\n                </div>\r\n                <div class=\"food-price\">\r\n                  <span class=\"current-price\">￥{{food.price}}</span>\r\n                  <del v-if=\"food.oldPrice\" class=\"old-price\">￥{{food.oldPrice}}</del>\r\n                  <cartcontrol class=\"select\" v-bind:food=\"food\" v-bind:selectfoods=\"selectfoods\" v-on:drop=\"drop\"></cartcontrol>\r\n                </div>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <food v-bind:food=\"selectedFood\" v-bind:show=\"show\" v-bind:selectfoods=\"selectfoods\" v-bind:shopcartComponent=\"shopcartComponent\" v-on:detailclose=\"selectFood\"></food>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Scroll from 'better-scroll'\r\nimport cartcontrol from '../cartcontrol/cartcontrol.vue'\r\nimport food from '../food/food.vue'\r\n\r\nconst ERROK = 0\r\n\r\nexport default {\r\n  props: {\r\n    seller: {\r\n      type: Object,\r\n      required: true\r\n    },\r\n    //已选择的食品\r\n    selectfoods: {\r\n      type: Array,\r\n      required: true\r\n    },\r\n    //shopcart组件实例\r\n    shopcartComponent: {\r\n      type: Object,\r\n      required: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      //异步从服务器get数据\r\n      goods: [],\r\n      //不同的type映射到不同的class\r\n      classMap: ['decrease', 'discount', 'special', 'invoice', 'guarantee'],\r\n      //存放右侧栏目高度\r\n      heightArray: [],\r\n      //当前滚动高度\r\n      currentHeight: 0,\r\n      //进入食品详情页时该食品的数据\r\n      selectedFood: {},\r\n      //食品详情页是否显示\r\n      show: false\r\n    }\r\n  },\r\n  created: function () {\r\n    this.$http.get('/api/goods')\r\n    .then((res) => {\r\n      if (res.data.errno === ERROK) {\r\n        this.goods = res.data.data\r\n      }\r\n      else new Error()\r\n    })\r\n    .catch((error) => {\r\n      console.log(error)\r\n    })\r\n  },\r\n  mounted: function () {\r\n      this.scrollMenu = new Scroll(this.$refs.menu, {\r\n        click: true\r\n      })\r\n\r\n      this.scrollFood = new Scroll(this.$refs.food, {\r\n        click: true,\r\n        probeType: 3\r\n      })\r\n      this.scrollFood.on('scroll', (pos) => {\r\n        this.currentHeight = Math.abs(pos.y)\r\n      })\r\n  },\r\n  computed: {\r\n    leftIndex: function () {\r\n      for (let i = 0; i < this.heightArray.length; i++) {\r\n        if (this.heightArray[i + 1] && this.currentHeight >= this.heightArray[i] && this.currentHeight < this.heightArray[i + 1]) {\r\n          return i\r\n        }\r\n      }\r\n      return 0\r\n    }\r\n  },\r\n  watch: {\r\n    goods: function() {\r\n      this.$nextTick(() => {\r\n        let foodList = this.$refs.fooditem, addHeight = 0\r\n        this.heightArray.push(0)\r\n        for (let i = 0; i < foodList.length; i++) {\r\n          addHeight += foodList[i].clientHeight\r\n          this.heightArray.push(addHeight)\r\n        }\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    scrollto: function (index, event) {\r\n      if (!event._constructed) {\r\n        return\r\n      }\r\n      else {\r\n        const foods = this.$refs.fooditem\r\n        let target = foods[index]\r\n        this.scrollFood.scrollToElement(target, 400)\r\n      }\r\n    },\r\n    drop: function (el) {\r\n      this.shopcartComponent.dropball(el)\r\n    },\r\n    selectFood: function (food) {\r\n      if (food) {\r\n        this.selectedFood = food\r\n      }\r\n      this.show = !this.show\r\n    }\r\n  },\r\n  components: {\r\n    cartcontrol,\r\n    food\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n@import '../../common/stylus/mixin.styl'\r\n\r\n.goods\r\n  display: flex\r\n  height: calc(100% - 222px)\r\n  overflow: hidden\r\n  .menu-wrapper\r\n    flex: 0 0 auto\r\n    width: 80px\r\n    .menu-list\r\n      .menu-item\r\n        display: table\r\n        padding-left: 12px\r\n        width: 100%\r\n        height: 54px\r\n        line-height: 14px\r\n        background: #f3f5f7\r\n        box-sizing: border-box\r\n        border-1px(rgba(7, 17, 27, 0.1))\r\n        &.on\r\n          background: white;\r\n          &>span \r\n            color: #07111b\r\n            font-weight: 500\r\n        &>span\r\n          color: #43474d\r\n        .menu-name\r\n          display: table-cell\r\n          width: 56px\r\n          vertical-align: middle\r\n          font-size: 12px\r\n          .icon\r\n            display: inline-block\r\n            vertical-align : top\r\n            margin-right: 2px\r\n            width: 12px\r\n            height: 12px\r\n            background-size: 12px 12px\r\n            background-repeat: no-repeat\r\n            &.decrease\r\n              bgImage-size('decrease_3')\r\n            &.discount\r\n              bgImage-size('discount_3')\r\n            &.guarantee\r\n              bgImage-size('guarantee_3')\r\n            &.invoice\r\n              bgImage-size('invoice_3')\r\n            &.special\r\n              bgImage-size('special_3')\r\n  .foods-wrapper\r\n    flex: 1\r\n    .food-menu\r\n      padding-left: 14px\r\n      box-sizing: border-box\r\n      height: 26px\r\n      line-height: 26px\r\n      font-size: 12px\r\n      font-weight: 500\r\n      color: rgb(147, 153, 159)\r\n      border-left: 3px solid #d9dde1\r\n      background: #f3f5f7\r\n    .food-list\r\n      padding: 0 18px\r\n      .food-item\r\n        display: flex\r\n        padding: 18px 0\r\n        border-1px(rgba(7, 17, 27, 0.1))\r\n        &:last-child\r\n          border-bottom: none\r\n        .food-icon\r\n          flex: 0 0 auto\r\n          width: 72px\r\n          height: 72px\r\n          &>img\r\n            display: inline-block\r\n            width: 100%\r\n            height: 100%\r\n        .food-detail\r\n          flex: 1\r\n          margin-left: 10px\r\n          vertical-align: top\r\n          .food-select-wrapper\r\n            .food-name\r\n              margin-top: 2px\r\n              font-size: 14px\r\n              font-weight: 400\r\n              color: rgb(7, 17, 27)\r\n            .food-description\r\n              margin-top: 8px\r\n              font-size: 10px\r\n              font-weight: 500\r\n              color: rgb(147, 153, 159)\r\n            .food-data\r\n              margin: 8px 0\r\n              font-size: 10px\r\n              color: rgb(147, 153, 159)\r\n              .food-sell\r\n                font-weight: 500\r\n              .food-rating\r\n                margin-left: 12px\r\n                font-weight: 500\r\n          .food-price\r\n            position: relative\r\n            font-size: 0\r\n            height: 24px\r\n            line-height: 24px\r\n            .current-price\r\n              font-size: 14px\r\n              font-weight: 700\r\n              color: red\r\n            .old-price\r\n              margin-left: 8px\r\n              font-size: 10px\r\n              font-weight: 700\r\n              color: rgb(147, 153, 159)\r\n            .select\r\n              position: absolute\r\n              right: 0\r\n              top: 0\r\n</style>"]}]}